<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NephroFlow CRRT Suite</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/themes/dark.css" id="theme-style">
</head>
<body>
    <div class="app-wrapper">
        <!-- Top Navigation -->
        <nav class="app-nav">
            <div class="branding">
                <img src="assets/icons/logo.svg" alt="NephroFlow Logo" class="logo">
                <h1>CRRT Management Suite</h1>
            </div>
            <div class="app-controls">
                <div class="language-selector">
                    <select id="language-select" aria-label="Select interface language">
                        <option value="en">English</option>
                        <option value="es">Español</option>
                        <option value="fr">Français</option>
                        <option value="de">Deutsch</option>
                        <option value="zh">中文</option>
                    </select>
                </div>
                <button id="theme-toggle" class="icon-btn" aria-label="Toggle dark mode">
                    <svg class="theme-icon"><use href="assets/icons/theme.svg#icon"></use></svg>
                </button>
                <button id="help-btn" class="icon-btn" aria-label="Open help">
                    <svg class="help-icon"><use href="assets/icons/help.svg#icon"></use></svg>
                </button>
            </div>
        </nav>

        <!-- Main Application Grid -->
        <div class="app-grid">
            <!-- Patient Parameters Column -->
            <section class="patient-col">
                <div class="parameter-card">
                    <h2 class="card-title">Patient Profile</h2>
                    <div class="input-group">
                        <label for="patient-weight">Weight (kg)</label>
                        <input type="number" id="patient-weight" min="20" max="300" step="0.1" value="70">
                    </div>
                    <div class="input-group">
                        <label for="patient-age">Age</label>
                        <div class="range-input">
                            <input type="range" id="patient-age" min="18" max="120" value="50">
                            <span id="age-display">50</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="patient-height">Height (cm)</label>
                        <input type="number" id="patient-height" min="100" max="250" value="170">
                    </div>
                    <div class="input-group">
                        <label for="apache-score">APACHE II Score</label>
                        <input type="number" id="apache-score" min="0" max="71" value="15">
                    </div>
                </div>

                <div class="parameter-card">
                    <h2 class="card-title">Lab Values</h2>
                    <div class="lab-grid">
                        <div class="lab-item">
                            <label>K⁺ (mEq/L)</label>
                            <input type="number" class="lab-value" value="4.2" step="0.1" min="1" max="10">
                        </div>
                        <div class="lab-item">
                            <label>HCO₃⁻ (mEq/L)</label>
                            <input type="number" class="lab-value" value="22" step="1" min="5" max="50">
                        </div>
                        <div class="lab-item">
                            <label>Ca²⁺ (mg/dL)</label>
                            <input type="number" class="lab-value" value="8.5" step="0.1" min="4" max="15">
                        </div>
                        <div class="lab-item">
                            <label>BUN (mg/dL)</label>
                            <input type="number" class="lab-value" value="45" step="1" min="5" max="200">
                        </div>
                    </div>
                </div>
            </section>

            <!-- CRRT Circuit Visualization -->
            <section class="circuit-col">
                <div class="circuit-card">
                    <div class="circuit-header">
                        <h2 class="card-title">CRRT Circuit</h2>
                        <div class="modality-tabs">
                            <button class="modality-tab active" data-modality="CVVH">CVVH</button>
                            <button class="modality-tab" data-modality="CVVHD">CVVHD</button>
                            <button class="modality-tab" data-modality="CVVHDF">CVVHDF</button>
                        </div>
                    </div>
                    <div class="circuit-animation" id="circit-animation-container">
                        <!-- Dynamic SVG will be inserted here -->
                    </div>
                    <div class="circuit-controls">
                        <div class="flow-control">
                            <label for="blood-flow">Blood Flow (mL/min)</label>
                            <input type="range" id="blood-flow" min="50" max="300" value="150">
                            <span class="flow-value">150</span>
                        </div>
                        <div class="pressure-readings">
                            <div class="pressure">
                                <span class="pressure-label">Pre-filter</span>
                                <span class="pressure-value normal">180 mmHg</span>
                            </div>
                            <div class="pressure">
                                <span class="pressure-label">TMP</span>
                                <span class="pressure-value normal">120 mmHg</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Fluid Management Column -->
            <section class="fluid-col">
                <div class="fluid-card">
                    <h2 class="card-title">Fluid Management</h2>
                    
                    <!-- Pre-filter Section -->
                    <div class="fluid-section">
                        <h3 class="fluid-heading">
                            <svg class="fluid-icon"><use href="assets/icons/prefilter.svg#icon"></use></svg>
                            Pre-filter Replacement
                        </h3>
                        <div class="fluid-controls">
                            <div class="fluid-rate">
                                <label for="prefilter-rate">Rate (mL/hr)</label>
                                <input type="number" id="prefilter-rate" min="0" max="5000" step="50" value="1000">
                            </div>
                            <div class="fluid-composition">
                                <label for="prefilter-solution">Solution</label>
                                <select id="prefilter-solution">
                                    <option value="bicarb">Bicarbonate (Na 140, HCO₃ 32)</option>
                                    <option value="citrate">Citrate (ACD-A)</option>
                                    <option value="custom">Custom Composition</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Dialysate Section -->
                    <div class="fluid-section">
                        <h3 class="fluid-heading">
                            <svg class="fluid-icon"><use href="assets/icons/dialysate.svg#icon"></use></svg>
                            Dialysate
                        </h3>
                        <div class="fluid-controls">
                            <div class="fluid-rate">
                                <label for="dialysate-rate">Rate (mL/hr)</label>
                                <input type="number" id="dialysate-rate" min="0" max="5000" step="50" value="2000">
                            </div>
                            <div class="fluid-composition">
                                <label for="dialysate-solution">Composition</label>
                                <select id="dialysate-solution">
                                    <option value="standard">Standard (K 4.0)</option>
                                    <option value="lowK">Low Potassium (K 2.0)</option>
                                    <option value="highBicarb">High Bicarbonate (HCO₃ 40)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Post-filter Section -->
                    <div class="fluid-section">
                        <h3 class="fluid-heading">
                            <svg class="fluid-icon"><use href="assets/icons/postfilter.svg#icon"></use></svg>
                            Post-filter Replacement
                        </h3>
                        <div class="fluid-controls">
                            <div class="fluid-rate">
                                <label for="postfilter-rate">Rate (mL/hr)</label>
                                <input type="number" id="postfilter-rate" min="0" max="3000" step="50" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Anticoagulation Section -->
                <div class="anticoag-card">
                    <h2 class="card-title">Anticoagulation</h2>
                    <div class="anticoag-controls">
                        <div class="anticoag-selector">
                            <select id="anticoag-method">
                                <option value="citrate">Regional Citrate</option>
                                <option value="heparin">Heparin</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                        <div class="anticoag-params" id="citrate-params">
                            <div class="param-group">
                                <label for="citrate-rate">ACD-A Rate (mL/hr)</label>
                                <input type="number" id="citrate-rate" min="0" max="500" value="150">
                            </div>
                            <div class="param-group">
                                <label for="calcium-rate">Calcium Rate (mmol/hr)</label>
                                <input type="number" id="calcium-rate" min="0" max="10" step="0.1" value="2.5">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results and Monitoring Column -->
            <section class="results-col">
                <div class="results-card">
                    <h2 class="card-title">Treatment Summary</h2>
                    <div class="results-grid">
                        <div class="result-item primary">
                            <div class="result-label">Effluent Dose</div>
                            <div class="result-value">24.8</div>
                            <div class="result-unit">mL/kg/hr</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Ultrafiltration</div>
                            <div class="result-value">100</div>
                            <div class="result-unit">mL/hr</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Filter Life</div>
                            <div class="result-value">68</div>
                            <div class="result-unit">hours</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Clearance</div>
                            <div class="result-value">35</div>
                            <div class="result-unit">L/day</div>
                        </div>
                    </div>
                </div>

                <div class="alerts-card">
                    <h2 class="card-title">Safety Alerts</h2>
                    <div class="alerts-list" id="safety-alerts">
                        <div class="alert-item warning">
                            <svg class="alert-icon"><use href="assets/icons/warning.svg#icon"></use></svg>
                            <div class="alert-message">Post-filter rate exceeds 30% of blood flow</div>
                        </div>
                        <div class="alert-item info">
                            <svg class="alert-icon"><use href="assets/icons/info.svg#icon"></use></svg>
                            <div class="alert-message">Consider increasing citrate for filter longevity</div>
                        </div>
                    </div>
                </div>

                <div class="monitoring-card">
                    <h2 class="card-title">Monitoring Plan</h2>
                    <ul class="monitoring-list">
                        <li>Ionized Ca²⁺ q4h</li>
                        <li>K⁺, HCO₃⁻ q6h</li>
                        <li>Filter pressures q1h</li>
                        <li>Circuit inspection q8h</li>
                    </ul>
                </div>
            </section>
        </div>

        <!-- Action Footer -->
        <footer class="action-footer">
            <button class="btn-secondary" id="reset-btn">
                <svg class="btn-icon"><use href="assets/icons/reset.svg#icon"></use></svg>
                Reset
            </button>
            <button class="btn-primary" id="save-btn">
                <svg class="btn-icon"><use href="assets/icons/save.svg#icon"></use></svg>
                Save Protocol
            </button>
            <button class="btn-export" id="export-btn">
                <svg class="btn-icon"><use href="assets/icons/export.svg#icon"></use></svg>
                Export PDF
            </button>
        </footer>
    </div>

    <!-- JavaScript Files -->
    <script src="js/vendor/d3.v7.min.js"></script>
    <script src="js/circuit-renderer.js"></script>
    <script src="js/fluid-calculator.js"></script>
    <script src="js/safety-validator.js"></script>
    <script src="js/language-service.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
